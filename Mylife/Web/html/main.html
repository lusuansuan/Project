
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>即时通讯2222</title>
    <link rel="stylesheet" href="../css/Chat.css">
    <link href="../js/layer/skin/layer.css" rel="stylesheet" />
    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/Public.js"></script>
    <script src="../js/layer/layer.js"></script>
</head>
<body>
    <div id="xximmm" class="xxim_main">
        <div class="xxim_top" id="xxim_top">
            <div class="xxim_search">
                <i></i><input id="xxim_searchkey">
                <span id="xxim_closesearch">×</span>
            </div>
            <div class="xxim_tabs" id="xxim_tabs"><span class="xxim_tabfriend xxim_tabnow" title="好友"><i></i></span><span class="xxim_tabgroup" title="群组"><i></i></span><span class="xxim_latechat" title="最近聊天"><i></i></span></div>
            <ul class="xxim_list" style="display: block;">              
                <!--<li ondblclick="showPage(this)" class="listImg">
                    <img src="../images/test1.jpg" alt="" class="smallImg">
                    <span>游客</span>
                </li>-->
            </ul>
            <ul class="xxim_list" style="display: none;">
                <li class="xxim_errormsg">请求失败</li>
            </ul>
            <ul class="xxim_list" style="display: none;"></ul>
            <ul class="xxim_list xxim_searchmain" id="xxim_searchmain" style="display: none;"></ul>
        </div>
        <ul class="xxim_bottom" id="xxim_bottom">
            <!--<li class="xxim_online" id="xxim_online">
                <i class="xxim_nowstate"></i><span id="xxim_onlinetex">在线</span>
                <div class="xxim_setonline" style="display: none;"><span><i></i>在线</span><span class="xxim_setoffline"><i></i>隐身</span></div>
            </li>
            <li class="xxim_mymsg" id="xxim_mymsg" title="我的私信">
                <i></i>
                <a href="私信地址" target="_blank"></a>
            </li>
            <li class="xxim_seter" id="xxim_seter" title="设置">
                <i></i>
                <div class=""></div>
            </li>
            <li class="xxim_hide" id="xxim_hide"><i></i></li>-->
            <li id="xxim_on" class="xxim_icon xxim_on"></li>
            <!--<div class="layim_min" id="layim_min"></div>-->
        </ul>
    </div>
    <!-- 消息窗口 -->
    <div class="layout-P" style="display:none;">
        <!-- 头部 -->
        <div class="titleCls">
            <img src="../images/test1.jpg" class="bigImg topHdp">
            <span class="topName">游客</span>
            <div class="text-R">
                <!--<i class="icon-jian"></i>-->
                <b class="icon-cha" onclick="closeWin()"></b>
            </div>
        </div>
        <!-- 消息 -->
        <div class="msgCls">
            <!-- 右边信息 -->
            <div class="Msg text-R">
                <div>
                    <span class="col-gray">2017-10-12 14:29</span>
                    <i class="marLR">德伟</i>
                    <img src="../images/test2.jpg" alt="" class="smallImg">
                </div>
                <span>你好！</span>
            </div>
            <!-- 左边信息 -->
            <div class="Msg text-L">
                <div>
                    <img src="images/test1.jpg" alt="" class="smallImg">
                    <i class="marLR">游客</i>
                    <span class="col-gray">2017-10-12 14:30</span>
                </div>
                <span>不好！</span>
            </div>
        </div>
        <!--  操作栏 -->
        <div class="operationCls">
            <i class="icon icon-bq"></i>
            <i class="icon icon-tp"></i>
            <i class="icon icon-fj"></i>
            <div class="text-R">
                <i class="icon icon-jl"></i>
                <span class="fontS12">聊天记录</span>
            </div>
        </div>
        <textarea name="" class="areaCls"></textarea>
        <div class="bg-f3">
            <span class="buttonCls fontS12">发送</span>
        </div>
    </div>
    <script src="../../Scripts/jquery.signalR-2.2.2.min.js"></script>
    <script src="/signalr/hubs"></script>
    <script>

        //打开聊天窗口
        function showPage(persent, FriendId, HeadPicture, UserName)//
        {
            $('.topHdp').attr('src', HeadPicture)
            $('.topName').text(UserName);
            $('.layout-P').show();
        }
        //关闭窗口
        function closeWin()//
        {
            $('.layout-P').hide();
        }


        //Signalr绑定后事件
        $(function () {

            //建立與Server端的Hub的物件，注意Hub的開頭字母一定要為小寫
            var chat = $.connection.ConHub;

            //连接成功后获取自己的信息
            $.connection.hub.start().done(function () {
                //當連線完成後，呼叫Server端的userConnected方法，並傳送使用者姓名給Server
                chat.server.connect();
            });

            //获取好友列表
            chat.client.getFriendsList = function (res) {
                var strhtml = '';
                if (res.Code == 1)//
                {
                    $.each(res.Data, function (index, item) {
                        strhtml += '<li class="listImg" id="' + item.FriendId + '" ondblclick="showPage(this,\'' + item.FriendId + '\',\'' + GetPhyPath(item.HeadPicture) + '\',\'' + item.Remark + '(' + item.UserName+')'+ '\')" >';
                        strhtml += ' <img src="' + GetPhyPath(item.HeadPicture) + '" alt="" class="smallImg">  &emsp;<span>' + item.Remark + '(' + item.UserName + ')</span>';
                        strhtml += '</li>';
                    })
                    $('#xximmm').find('.xxim_list:eq(0)').html(strhtml);
                }
            }
            //好友上线提示
            chat.client.onLineTips = function (res) {
                LayerMsg(res);
            }

            //给选择的人员发送信息
            chat.client.sendMessage = function (name, message) {
                var NowDate = new Date();
                var strhtml = '';
               
                $('#thelist').append(strhtml);
               
            }


            $("#SenBtn").click(function () {
                var Content = $('#ReplyContent').val();
                if (Content == "") {
                    layerMsg('请输入内容');
                    return;
                }

                var strmodel = {
                    UserID: CodeID,//用户ID或公司ID
                    TalkContent: Content,// 聊天内容
                    MsgType: '0', //消息类别：0普通消息（文字），1语音消息，2商品咨询，3订单咨询,4地理位置，5附件（图片）
                    ProductJson: '{}',//商品信息json:
                    OrderJson: '{}',//订单信息json:
                    AddressJson: '{}'  //地址信息json:                   
                }
                $("#ReplyContent").val('');
                chat.server.sendMessage(JSON.stringify(strmodel), Flag, UserInfo.UserID, UserInfo.RoleType);
            });
               
        });











    </script>
</body>
</html>